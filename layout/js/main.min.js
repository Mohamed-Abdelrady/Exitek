window.addEventListener("load", function() {
    $(".loader").addClass("hide");
    $(".wrapper").addClass("show");
    $("body").removeClass("active");
    
    // typescript animation of header
    // if ($('.typescript_heading')) {
    //     const typeHeadingChild = document.querySelector('.typescript_heading').children,
    //         textArray = typeHeadingChild[0].innerText.split(''),
    //         textArrayLast = typeHeadingChild[1].innerText.split('');
    //         typeHeadingChild[0].innerText = '';
    //         typeHeadingChild[1].innerText = '';
    //     function typeWriter() {
    //         return new Promise((resolve) => {
    //             setTimeout(() => {
    //                 resolve('resolved');
    //             }, 1000);
    //         });
    //     }
    //     async function typeWriterCall() {
    //         textArray.forEach((letter, i) =>
    //             setTimeout(() => (typeHeadingChild[0].innerText += letter), 70 * i),
    //         );
    //         const result = await typeWriter();
    //         textArrayLast.forEach((letter, i) =>
    //             setTimeout(() => (typeHeadingChild[1].innerText += letter), 30 * i),
    //         );
    //     }
    //     typeWriterCall();
    // }
    
    // animations
    ScrollReveal({
        distance: '60px',
        duration: 600,
    });    ScrollReveal().reveal('.page-content > .header h1', {
        delay: 100,
        origin: 'bottom',
    });
    ScrollReveal().reveal('.page-content > .header p', {
        delay: 150,
        origin: 'bottom',
    });
    ScrollReveal().reveal('.page-content > .header a', {
        delay: 200,
        origin: 'bottom',
    });
    ScrollReveal().reveal('.page-content > .header .bottom .image', {
        delay: 200,
        origin: 'left',
    });
    ScrollReveal().reveal('.page-content > .header .bottom li, .header .bottom li *', {
        delay: 200,
        origin: 'left',
        interval: 50
    });

    ScrollReveal().reveal('.section', {
        delay: 100,
        origin: 'bottom',
    });
    ScrollReveal().reveal('.section .text:not(.reverse) *', {
        delay: 200,
        origin: 'right',
        interval: 50
    });
    ScrollReveal().reveal('.section .image:not(.reverse) *', {
        delay: 300,
        origin: 'left',
        interval: 50
    });
    ScrollReveal().reveal('.section .text.reverse *', {
        delay: 200,
        origin: 'left',
        interval: 50
    });
    ScrollReveal().reveal('.section .image.reverse *', {
        delay: 300,
        origin: 'right',
        interval: 50
    });
    ScrollReveal().reveal('.banners h1', {
        delay: 100,
        origin: 'top',
    });
    ScrollReveal().reveal('.banners p', {
        delay: 200,
        origin: 'center',
    });
    ScrollReveal().reveal('.banners a', {
        delay: 300,
        origin: 'bottom',
    });
    ScrollReveal().reveal('.values', {
        delay: 100,
        origin: 'left',
    });
    ScrollReveal().reveal('.who-we , .who-we *, .testimonials ,.testimonials *, .values *, .offer, .offer *, .open-position ,.open-position *', {
        delay: 100,
        origin: 'bottom',
    });
    ScrollReveal().reveal('.who-box ,.who-box *, .testimonial, .testimonial *, .value ,.value *, .offer-box, .offer-box *, .position , .contact-us *', {
        delay: 110,
        origin: 'left',
        interval: 50
    });
    ScrollReveal().reveal('.position *', {
        delay: 100,
        origin: 'left',
    });
})

    // open navbar for mobile
$(".navbar-up .open-menu").bind("click", () => {
    $(".navbar-up .nav-parent").addClass("active");
    $(document.body).addClass("active");
})
$(".navbar-up .close-menu").bind("click", () => {
    $(".navbar-up .nav-parent").removeClass("active");
    $(document.body).removeClass("active");
})

// open position job
$(".open-position #position-pop-up").on("click", (e) => {
    e.preventDefault();
    $(document.body).addClass("active");
    $(".position-pop-up").addClass("show");
    resizeNavPop();
})

// close position job
$(".position-pop-up .close").on("click", (e) => {
    e.preventDefault();
    $(document.body).removeClass("active");
    $(".position-pop-up").removeClass("show");
    resizeNavWindow();
})

// resive nav when scroll
window.addEventListener('scroll', function() {
    resizeNavWindow()
});
$(".position-pop-up").on('scroll', function() {
    resizeNavPop()
});
function resizeNavWindow() {
    if(window.scrollY > 0) {
        $(".navbar-up").addClass('resize');
        $(".navbar-up .btn").addClass('btn-blue');
    } else {
        $(".navbar-up").removeClass('resize');
        $(".navbar-up .btn").removeClass('btn-blue');
    }
}
function resizeNavPop() {
    if($(".position-pop-up").scrollTop() > 0) {
        $(".navbar-up").addClass('resize');
        $(".navbar-up .btn").addClass('btn-blue');
    } else {
        $(".navbar-up").removeClass('resize');
        $(".navbar-up .btn").removeClass('btn-blue');
    }
}

// submit form
let nameError = true;
let emailError = true;
let messageError = true;

const scriptURL = 'https://script.google.com/macros/s/AKfycby7f3ZpEXyZwlMXuoJ1GUYyG12RGmV4ZlHU2aoq4jhpCKv3woTWGKl_zzSSqlVKezKVcQ/exec'
const form = document.forms['position-form']

$("#btnSubmit").on("click", (e) => {
    var reader = new FileReader();
    var file = document.getElementById('attach').files[0];
    validateName();
    validateEmail();
    validateMessage();
    if(document.getElementById('attach').value != '') {
        reader.onload = function(){
            document.getElementById('fileContent').value=reader.result;
            document.getElementById('filename').value=file.name;
            if ( nameError == true && emailError == true && messageError == true ) {
                fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                .then(response => {
                    SuccessResponse();})
                .catch(error => console.error('Error!', error.message));
            } else {
                return false;
            }
        }
        reader.readAsDataURL(file);
    } else {
        if ( nameError == true && emailError == true && messageError == true ) {
            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                SuccessResponse();})
            .catch(error => console.error('Error!', error.message));
        } else {
            return false;
        }
    }
});

function SuccessResponse() {
    document.querySelector(".form .button").innerHTML = `
        <div class="success">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M10.6555 14.0332L8.45463 11.8324C8.32347 11.7012 8.15859 11.6341 7.96001 11.6311C7.76142 11.628 7.59351 11.6952 7.45627 11.8324C7.31902 11.9697 7.2504 12.136 7.2504 12.3316C7.2504 12.5271 7.31902 12.6935 7.45627 12.8307L10.0561 15.4305C10.2273 15.6018 10.4271 15.6874 10.6555 15.6874C10.8838 15.6874 11.0836 15.6018 11.2548 15.4305L16.5255 10.1599C16.6567 10.0287 16.7238 9.86386 16.7268 9.66527C16.7299 9.46669 16.6628 9.29878 16.5255 9.16153C16.3883 9.02429 16.2219 8.95567 16.0263 8.95567C15.8308 8.95567 15.6644 9.02429 15.5272 9.16153L10.6555 14.0332ZM12.0016 21C10.7568 21 9.58677 20.7638 8.49148 20.2914C7.39618 19.8189 6.44342 19.1778 5.63322 18.368C4.82299 17.5581 4.18157 16.6058 3.70894 15.511C3.23631 14.4162 3 13.2464 3 12.0016C3 10.7568 3.23621 9.58677 3.70863 8.49148C4.18106 7.39618 4.82219 6.44343 5.63203 5.63322C6.44189 4.823 7.39423 4.18157 8.48904 3.70894C9.58384 3.23631 10.7536 3 11.9984 3C13.2432 3 14.4132 3.23621 15.5085 3.70863C16.6038 4.18106 17.5566 4.82219 18.3668 5.63203C19.177 6.44189 19.8184 7.39423 20.2911 8.48904C20.7637 9.58384 21 10.7536 21 11.9984C21 13.2432 20.7638 14.4132 20.2914 15.5085C19.8189 16.6038 19.1778 17.5566 18.368 18.3668C17.5581 19.177 16.6058 19.8184 15.511 20.2911C14.4162 20.7637 13.2464 21 12.0016 21ZM12 19.579C14.1158 19.579 15.9079 18.8448 17.3763 17.3763C18.8448 15.9079 19.579 14.1158 19.579 12C19.579 9.8842 18.8448 8.09209 17.3763 6.62367C15.9079 5.15525 14.1158 4.42103 12 4.42103C9.8842 4.42103 8.09209 5.15525 6.62367 6.62367C5.15524 8.09209 4.42103 9.8842 4.42103 12C4.42103 14.1158 5.15524 15.9079 6.62367 17.3763C8.09209 18.8448 9.8842 19.579 12 19.579Z" fill="#3D9250"/>
            </svg>
            Message has been successfully sent
        </div>
    `;
    $("#name").val("");
    $("#email").val("");
    $("#message").val("");
    $(".upload-value").text("");
    $(".form .resume-parent").removeClass("selected");
    $("#position-form .input-field").removeClass("invalid");
    $("#position-form .input-field").removeClass("not-empty");
}



// validate inputs
$('#position-form .form-input').blur(function(e) {
    if(e.target.id == "name") {
        validateName();
    }
    if(e.target.id == "email") {
        validateEmail();
    }
    if(e.target.id == "message") {
        validateMessage();
    }
    if( $(this).val().length !== 0 ) {
        $(this).parents('.input-field').addClass('not-empty');
    }
    if( $(this).val().length == 0 ){
        $(this).parents('.input-field').removeClass('not-empty');
    }
});
function validateName() {
    let nameValue = $("#name").val();
    if (nameValue.length == "") {
        $("#nameCheck").parents(".input-field").addClass("invalid");
        nameError = false;
        return false;
    } else {
        $("#nameCheck").parents(".input-field").removeClass("invalid");
        nameError = true;
    }
}
function validateEmail() {
    let regex = /^([_\-\.0-9a-zA-Z]+)@([_\-\.0-9a-zA-Z]+)\.([a-zA-Z]){2,7}$/;
    let s = $("#email").val();
    if (!regex.test(s)) {
        $("#emailCheck").parents(".input-field").addClass("invalid");
        emailError = false;
        return false;
    } else {
        $("#emailCheck").parents(".input-field").removeClass("invalid");
        emailError = true;
    }
}
function validateMessage() {
    let messageValue = $("#message").val();
    if (messageValue.length == "") {
        $("#messageCheck").parents(".input-field").addClass("invalid");
        messageError = false;
        return false;
    } else {
        $("#messageCheck").parents(".input-field").removeClass("invalid");
        messageError = true;
    }
}

$(".resume-parent input").on("change" ,function() {
    var text = 
    $(".resume-parent .upload-value").text($(".resume-parent input").val().split("\\").pop());
    $(".resume-parent").addClass("selected");
});

// open job animation
$(".view-openings").click(function() {
    $('html, body').animate({
        scrollTop: $(".open-position").offset().top - 90
    }, 1000);
});

// JSON fetch to jop postiong
$(".open-position #position-pop-up").on("click", function(e){
    e.preventDefault();
    $.getJSON('vacancies.json', function(data) {
        let i = $(e.target).data("index");
        // define and append text inside Json file
        $(".position-pop-up .title").html(data[i].title);
        $(".position-pop-up .description").html(data[i].description);
        $(".position-pop-up .location").html(data[i].location);
        $(".position-pop-up .salary").html(data[i].salary);
        // define and append array inside Json file
        $(".position-pop-up .responsibilities").empty();
        jQuery.each( data[i].responsibilities, function( s, val ) {
            $(".position-pop-up .responsibilities").append('<li>' + val + '</li>');
        });
        $(".position-pop-up .requirements").empty();
        jQuery.each( data[i].requirements, function( s, val ) {
            $(".position-pop-up .requirements").append('<li>' + val + '</li>');
        });
        $(".position-pop-up .benefits").empty();
        jQuery.each( data[i].benefits, function( s, val ) {
            $(".position-pop-up .benefits").append('<li>' + val + '</li>');
        });
    });
});

// add careers number
$.getJSON('vacancies.json', function(data) {
    if(data.length > 0) {
        $(".navbar-up #career").append("<span>" + data.length +"</span>");
    }
});


